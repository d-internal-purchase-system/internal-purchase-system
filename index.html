<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì„ì§ì› êµ¬ë§¤ ì‹ ì²­</title>
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

  <style>
    :root{
      --bg:#f6f7f9; --card:#fff; --text:#111827; --muted:#6b7280; --line:#e5e7eb;
      --accent:#111827; --danger:#b91c1c; --ok:#065f46; --shadow: 0 10px 30px rgba(17,24,39,.08);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR","ë§‘ì€ ê³ ë”•",Arial,sans-serif;background:var(--bg);color:var(--text);}
    .container{max-width:1080px;margin:0 auto;padding:22px 14px 48px;}
    header{display:flex;justify-content:space-between;gap:12px;align-items:flex-end;margin-bottom:14px;}
    h1{margin:0;font-size:20px;letter-spacing:-.2px;}
    .subtitle{margin:6px 0 0;font-size:12.5px;line-height:1.45;color:var(--muted);}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:9px 12px;border:1px solid var(--line);background:#fff;border-radius:999px;font-size:12px;color:var(--muted);box-shadow:0 2px 10px rgba(17,24,39,.04);white-space:nowrap;}
    .pill b{color:var(--text)}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;}
    .cardBody{padding:14px 16px;}
    .muted{color:var(--muted)}
    .btn{padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#fff;cursor:pointer;font-size:13px;}
    .btn.primary{background:#111827;border-color:#111827;color:#fff;}
    .btn:disabled{opacity:.55;cursor:not-allowed;}
    .btn.danger{border-color:#fecaca;color:var(--danger);background:#fff;}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
    .divider{border:none;border-top:1px solid var(--line);margin:14px 0;}
    .stepper{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0 14px;}
    .step{flex:1;min-width:140px;border:1px solid var(--line);background:#fff;border-radius:14px;padding:10px 12px;display:flex;gap:10px;align-items:flex-start;}
    .stepNum{width:28px;height:28px;border-radius:999px;border:1px solid var(--line);display:grid;place-items:center;font-weight:900;font-size:12px;color:var(--muted);}
    .step.active{border-color:#111827}
    .step.active .stepNum{border-color:#111827;color:#111827}
    .stepTitle{font-weight:900;font-size:13px;letter-spacing:-.1px;margin:0}
    .stepDesc{margin:4px 0 0;font-size:12px;color:var(--muted);line-height:1.35}
    .section{display:none}
    .section.active{display:block}

    .step1Grid{display:grid;grid-template-columns: 1.55fr .95fr; gap:12px; align-items:start;}
    @media (max-width:960px){.step1Grid{grid-template-columns:1fr}}
    .panel{border:1px solid var(--line);border-radius:14px;background:#fff;overflow:hidden;}
    .panelHeader{padding:12px 12px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center;gap:10px;}
    .panelHeader h3{margin:0;font-size:13px;letter-spacing:-.1px;}
    .panelBody{padding:12px 12px;}
    .badge{display:inline-flex;align-items:center;gap:6px;font-size:12px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#fff;color:var(--muted);white-space:nowrap;}
    .badge strong{color:var(--text)}

    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;}
    .tab{border:1px solid var(--line);background:#fff;border-radius:999px;padding:8px 10px;font-size:13px;cursor:pointer;}
    .tab.active{background:#111827;border-color:#111827;color:#fff;}

    .products{display:grid;grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));gap:10px;}
    @media (max-width:520px){.products{ grid-template-columns: 1fr; }}

    .product{border:1px solid var(--line);border-radius:14px;padding:12px;background:#fff;display:flex;flex-direction:column;gap:10px;min-width:0;}
    .productTop{display:flex;flex-direction:column;gap:10px;align-items:stretch;}
    .thumb{position:relative;width:100%;height:160px;border-radius:14px;border:1px solid var(--line);background:#f9fafb;display:flex;align-items:center;justify-content:center;overflow:hidden;padding:10px;}
    .thumb img{max-width:100%;max-height:100%;width:auto;height:auto;object-fit:contain;object-position:center;display:block;}
    .thumb .ph{font-size:12px;color:var(--muted);font-weight:900}

    .productInfo{min-width:0;}
    .productName{margin:0;font-weight:900;font-size:13.5px;letter-spacing:-.1px;line-height:1.25;word-break:keep-all;overflow-wrap:break-word;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden;}
    .productId{margin:4px 0 0;font-size:12px;color:var(--muted);font-weight:800;}
    .productMeta{margin:8px 0 0;font-size:12px;color:var(--muted);line-height:1.45;word-break:keep-all;overflow-wrap:break-word;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3;overflow:hidden;}
    .expiry{color:#b91c1c;font-weight:900;}

    .chips{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px;}
    .chip{display:inline-flex;align-items:center;gap:6px;font-size:12px;font-weight:900;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#fff;color:var(--muted);white-space:nowrap;}
    .chip.off{border-color:#1118271f;color:#111827;background:#f9fafb;}
    .chip.soldout{border-color:#fecaca;color:#b91c1c;background:#fff1f2;}
    .product.isSoldout{opacity:.82;}

    .priceLine{margin-top:6px;display:flex;justify-content:flex-end;font-weight:900;white-space:nowrap;}

    .qty{width:86px;padding:8px 10px;border:1px solid var(--line);border-radius:12px;font-size:14px;outline:none;}
    .miniHint{font-size:12px;color:var(--muted);line-height:1.4;margin-top:4px;}

    .qtyBadge{position:absolute;right:10px;bottom:10px;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:900;background:#111827;color:#fff;border:1px solid rgba(255,255,255,.35);box-shadow:0 10px 24px rgba(17,24,39,.22);}
    .qtyBadge.red{background:#b91c1c;}

    .cartList{display:flex;flex-direction:column;gap:10px;}
    .cartItem{border:1px solid var(--line);border-radius:14px;padding:10px 12px;background:#fff;display:flex;justify-content:space-between;gap:10px;min-width:0;}
    .cartItem .name{margin:0;font-weight:900;font-size:13px;max-width:360px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:0;}
    .cartItem .meta{margin:6px 0 0;font-size:12px;color:var(--muted);line-height:1.35;}
    .mini{display:flex;gap:6px;align-items:center;justify-content:flex-end;}
    .miniBtn{width:30px;height:30px;border-radius:12px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:900;display:grid;place-items:center;}
    .miniBtn:disabled{opacity:.45;cursor:not-allowed;}
    .miniQty{min-width:26px;text-align:center;font-weight:900;font-size:13px;}
    .sumBox{border:1px solid var(--line);border-radius:14px;padding:10px 12px;background:#fff;}
    .sumRow{display:flex;justify-content:space-between;align-items:center;font-size:13px;margin:6px 0;}
    .sumRow strong{font-weight:900}

    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px;}
    input[type="text"], input[type="tel"], textarea{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:12px;font-size:14px;outline:none;background:#fff;}
    textarea{min-height:90px;resize:vertical;}
    .form{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    @media (max-width:520px){.form{grid-template-columns:1fr}}
    .help{margin-top:10px;font-size:12px;color:var(--muted);line-height:1.5}

    .backdrop{position:fixed;inset:0;background:rgba(17,24,39,.45);display:none;align-items:center;justify-content:center;padding:16px;z-index:50;}
    .backdrop.open{display:flex;}
    .modal{width:min(920px,100%);background:#fff;border:1px solid var(--line);border-radius:18px;box-shadow:0 18px 60px rgba(17,24,39,.22);overflow:hidden;display:flex;flex-direction:column;max-height:86vh;}
    .modalHeader{padding:14px 16px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center;gap:10px;flex:0 0 auto;}
    .modalHeader h3{margin:0;font-size:15px;letter-spacing:-.1px;}
    .modalBody{padding:14px 16px;overflow:auto;flex:1 1 auto;}
    .modalFooter{padding:12px 16px;border-top:1px solid var(--line);display:flex;justify-content:flex-end;align-items:center;gap:10px;background:#fff;flex:0 0 auto;}
    table{width:100%;border-collapse:collapse;font-size:13px;}
    th,td{padding:10px 8px;border-bottom:1px solid var(--line);text-align:left;vertical-align:top;word-break:keep-all;overflow-wrap:break-word;}
    th{font-size:12px;color:var(--muted);font-weight:900;}
    .tfoot td{font-weight:900;border-bottom:none;padding-top:12px;}
    .status{font-size:12px;font-weight:900;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#fff;color:var(--muted);white-space:nowrap;}
    .status.ok{border-color:#bbf7d0;color:var(--ok);background:#f0fdf4;}
    .status.err{border-color:#fecaca;color:var(--danger);background:#fff1f2;}

    .policy{font-size:12px;line-height:1.6;background:#f9fafb;border:1px solid var(--line);border-radius:14px;padding:12px;max-height:260px;overflow:auto;}
    .checkRow{display:flex;gap:10px;align-items:flex-start;margin-top:12px;}
    .toast{position:fixed;left:50%;bottom:16px;transform:translateX(-50%);background:#111827;color:#fff;padding:10px 12px;border-radius:999px;font-size:13px;box-shadow:0 12px 30px rgba(17,24,39,.22);opacity:0;pointer-events:none;transition:opacity .18s ease, transform .18s ease;z-index:60;}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px);}

    /* [ê°œì„  3] ì£¼ì†Œ ë ˆì´ì–´: ëª¨ë°”ì¼ì—ì„œ ëª¨ë‹¬ ë°©ì‹ìœ¼ë¡œ ë¶„ê¸°ë˜ë¯€ë¡œ PCìš© ì¸ë¼ì¸ ë ˆì´ì–´ë§Œ ìœ ì§€ */
    .addrLayer{display:none;border:1px solid var(--line);border-radius:14px;overflow:hidden;height:420px;background:#fff;margin-top:10px;}
    .addrLayer.open{display:block;}

    /* [ê°œì„  3] ëª¨ë°”ì¼ ì£¼ì†Œê²€ìƒ‰ ëª¨ë‹¬ */
    .addrModalLayer{display:none;border:1px solid var(--line);border-radius:0;overflow:hidden;width:100%;height:100%;background:#fff;}
    .addrModalLayer.open{display:block;}

    .accountBox{border:1px solid var(--line);border-radius:14px;background:#f9fafb;padding:12px;}
    .accountBox .title{font-weight:900;margin:0 0 6px;}
    .accountBox .text{margin:0;color:var(--muted);font-size:12.5px;line-height:1.55;}
    .kvs{display:grid;grid-template-columns:120px 1fr;gap:8px 10px;font-size:13px;line-height:1.35;}
    @media (max-width:520px){.kvs{grid-template-columns:1fr}}

    .cartPreviewEmpty{font-size:12px;color:var(--muted);line-height:1.5;}

    /* ================================================================
       [ê°œì„  1] ì£¼ë¬¸ ë§ˆê°: ì „ì²´ í™”ë©´ ë®ëŠ” ë§ˆê° ì•ˆë‚´ ë°°ë„ˆ
       ================================================================ */
    .closedFullBanner{
      background:#fff1f2;
      border:1.5px solid #fecaca;
      border-radius:16px;
      padding:28px 24px;
      text-align:center;
      margin-bottom:20px;
    }
    .closedFullBanner .closedIcon{font-size:40px;margin-bottom:12px;}
    .closedFullBanner .closedTitle{font-size:18px;font-weight:900;color:#b91c1c;margin:0 0 8px;}
    .closedFullBanner .closedMsg{font-size:13px;color:#7f1d1d;line-height:1.6;margin:0;}

    /* ë§ˆê° ì‹œ ì •ì±… ë‚´ìš© íë¦¬ê²Œ ì²˜ë¦¬ */
    .policyDisabled{opacity:.4;pointer-events:none;user-select:none;}

    /* ================================================================
       [ê°œì„  2] ìµœì†Œ ì£¼ë¬¸ ê¸ˆì•¡ í”„ë¡œê·¸ë ˆìŠ¤ ë°”
       ================================================================ */
    .minOrderBar{
      margin-top:10px;
      background:#f3f4f6;
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 12px;
    }
    .minOrderBarLabel{
      display:flex;
      justify-content:space-between;
      font-size:12px;
      color:var(--muted);
      margin-bottom:8px;
    }
    .minOrderBarLabel .highlight{color:#111827;font-weight:900;}
    .minOrderBarTrack{
      width:100%;
      height:8px;
      background:#e5e7eb;
      border-radius:999px;
      overflow:hidden;
    }
    .minOrderBarFill{
      height:100%;
      background:#111827;
      border-radius:999px;
      transition:width .35s cubic-bezier(.4,0,.2,1);
      width:0%;
    }
    .minOrderBarFill.done{background:#059669;}
    .minOrderBarMsg{font-size:12px;margin-top:6px;color:var(--muted);}
    .minOrderBarMsg.ok{color:#065f46;font-weight:900;}

    .closedBanner{
      padding:10px 12px;margin-bottom:10px;border:1px solid #fecaca;background:#fff1f2;border-radius:12px;
      color:#b91c1c;font-weight:900;
    }
  </style>
</head>

<body>
  <div class="container" id="app" style="display:none;">
    <header>
      <div>
        <h1>2026 ì„¤ë§ì´ ì„ì§ì› êµ¬ë§¤ ì‹ ì²­</h1>
        <p class="subtitle">ê´€ë¦¬ì ìŠ¹ì¸ í›„ <b>íƒë°°ë¡œë§Œ</b> ë°œì†¡ë©ë‹ˆë‹¤. ê¸°ë³¸ ë°°ì†¡ë¹„ëŠ” <b>ë¬´ë£Œ</b>ì´ë©°, <b>ì œì£¼/ë„ì„œì‚°ê°„</b>ì€ ìš°í¸ë²ˆí˜¸ ê¸°ì¤€ìœ¼ë¡œ ì¶”ê°€ë°°ì†¡ë¹„ê°€ ì ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      </div>
      <div class="pill" id="topPill">ì¶œê³ : <b>íƒë°°ë°œì†¡</b> Â· ë°°ì†¡ë¹„: <b id="topShipFee">0ì›</b></div>
    </header>

    <div class="stepper">
      <div class="step active" id="step1"><div class="stepNum">1</div><div><p class="stepTitle">ìƒí’ˆ ì„ íƒ</p><p class="stepDesc">ì¹´í…Œê³ ë¦¬ì—ì„œ ë‹´ê¸°</p></div></div>
      <div class="step" id="step2"><div class="stepNum">2</div><div><p class="stepTitle">ì£¼ë¬¸ì ì •ë³´</p><p class="stepDesc">ìš”ì²­ì ì…ë ¥</p></div></div>
      <div class="step" id="step3"><div class="stepNum">3</div><div><p class="stepTitle">ìˆ˜ë ¹ì/ì£¼ì†Œ</p><p class="stepDesc">ë°°ì†¡ ì •ë³´ ì…ë ¥</p></div></div>
      <div class="step" id="step4"><div class="stepNum">4</div><div><p class="stepTitle">ìµœì¢… í™•ì¸</p><p class="stepDesc">ìš”ì•½ í›„ ì œì¶œ</p></div></div>
    </div>

    <div class="card">
      <div class="cardBody">

        <div class="section active" id="section1">
          <div class="row" style="justify-content:space-between;">
            <div>
              <h2 style="margin:0;font-size:15px;letter-spacing:-.1px;">ìƒí’ˆ ì„ íƒ</h2>
              <div class="muted" style="font-size:12px;margin-top:6px;">
                ì¹´í…Œê³ ë¦¬ì—ì„œ ë‹´ê³ , ì˜¤ë¥¸ìª½ ì¥ë°”êµ¬ë‹ˆì—ì„œ ìˆ˜ëŸ‰ì„ ì¡°ì ˆí•˜ì„¸ìš”.
                (ê¸°ë³¸ ìµœëŒ€ <b id="maxQtyText"></b>ê°œ, ì¼ë¶€ í’ˆëª©ì€ 1ê°œ ì œí•œ)
                <br> ì œí’ˆ ì‚¬ì§„ì„ í´ë¦­í•˜ë©´ ì„¸ë¶€ ì„¤ëª…ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
              </div>
            </div>
            <button class="btn danger" id="clearCartBtn" disabled>ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°</button>
          </div>

          <div class="divider"></div>

          <div class="step1Grid">
            <div class="panel">
              <div class="panelHeader">
                <h3>ìƒí’ˆ ëª©ë¡</h3>
                <span class="badge">ë°°ì†¡ë¹„ <strong id="badgeShipFee">0ì›</strong></span>
              </div>
              <div class="panelBody">
                <div class="tabs" id="tabs"></div>
                <div class="products" id="products"></div>
              </div>
            </div>

            <div class="panel">
              <div class="panelHeader">
                <h3>ì¥ë°”êµ¬ë‹ˆ</h3>
                <span class="badge">ë‹´ê¸´ ìƒí’ˆ <strong id="cartCount">0</strong></span>
              </div>
              <div class="panelBody">
                <div id="cartPreview"></div>

                <div class="divider"></div>

                <div class="sumBox">
                  <div class="sumRow"><span class="muted">ìƒí’ˆ í•©ê³„</span><strong id="itemsTotal">0ì›</strong></div>
                  <div class="sumRow"><span class="muted">ë°°ì†¡ë¹„</span><strong id="shipFeeLine">0ì›</strong></div>
                  <div class="sumRow"><span>ì´ ê²°ì œê¸ˆì•¡(ì‹¤ê²°ì œ ì—†ìŒ)</span><strong id="grandTotal">0ì›</strong></div>
                  <div class="miniHint" id="shipReason" style="margin-top:8px;"></div>
                </div>

                <!-- [ê°œì„  2] ìµœì†Œ ì£¼ë¬¸ ê¸ˆì•¡ í”„ë¡œê·¸ë ˆìŠ¤ ë°” -->
                <div class="minOrderBar" id="minOrderBarWrap">
                  <div class="minOrderBarLabel">
                    <span>ìµœì†Œ ì£¼ë¬¸ ê¸ˆì•¡</span>
                    <span><span id="minBarCurrent">0ì›</span> / <span class="highlight" id="minBarTarget">20,000ì›</span></span>
                  </div>
                  <div class="minOrderBarTrack">
                    <div class="minOrderBarFill" id="minBarFill"></div>
                  </div>
                  <div class="minOrderBarMsg" id="minBarMsg"></div>
                </div>

                <div class="divider"></div>

                <div class="row" style="justify-content:flex-end;">
                  <button class="btn primary" id="toStep2" disabled>ë‹¤ìŒ</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="section" id="section2">
          <h2 style="margin:0;font-size:15px;letter-spacing:-.1px;">ì£¼ë¬¸ì(ìš”ì²­ì) ì •ë³´</h2>
          <div class="muted" style="font-size:12px;margin-top:6px;">ì£¼ë¬¸ì€ íšŒì‚¬ ì‚¬ëŒì´ í•´ë„, ìˆ˜ë ¹ìëŠ” ê°€ì¡±/ì§€ì¸ìœ¼ë¡œ ì„¤ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>

          <div class="divider"></div>

          <div class="form">
            <div>
              <label>ì£¼ë¬¸ì ì´ë¦„(ì…ê¸ˆì) *</label>
              <input type="text" id="ordererName" placeholder="ì˜ˆ) í™ê¸¸ë™">
            </div>
            <div>
              <label>ì‚¬ë²ˆ(ì§ì›ë²ˆí˜¸) *</label>
              <input type="text" id="ordererEmpId" placeholder="ì˜ˆ) 123456">
            </div>
            <div>
              <label>ì£¼ë¬¸ì ì—°ë½ì²˜ *</label>
              <input type="tel" id="ordererPhone" placeholder="ì˜ˆ) 010-1234-5678">
            </div>
            <div>
              <label>ì‚¬ì—…ì¥/ë¶€ì„œ *</label>
              <input type="text" id="ordererDept" placeholder="ì˜ˆ) êµ­ë‚´ì‚¬ì—…ë³¸ë¶€/ì˜ì—…ì§€ì›íŒ€">
            </div>
          </div>

          <div class="divider"></div>

          <div class="row" style="justify-content:space-between;">
            <button class="btn" id="backTo1">ì´ì „</button>
            <button class="btn primary" id="toStep3" disabled>ë‹¤ìŒ</button>
          </div>
        </div>

        <div class="section" id="section3">
          <h2 style="margin:0;font-size:15px;letter-spacing:-.1px;">ìˆ˜ë ¹ì(ë°°ì†¡ ì •ë³´)</h2>
          <div class="muted" style="font-size:12px;margin-top:6px;">ìš°í¸ë²ˆí˜¸ ê¸°ì¤€ìœ¼ë¡œ ì œì£¼/ë„ì„œì‚°ê°„ ì¶”ê°€ë°°ì†¡ë¹„ê°€ ìë™ ì ìš©ë©ë‹ˆë‹¤.</div>

          <div class="divider"></div>
          <div class="row" style="margin:0 0 10px;">
            <label style="margin:0;display:flex;align-items:center;gap:8px;cursor:pointer;font-weight:800;">
              <input type="checkbox" id="sameAsOrdererChk">
              ì£¼ë¬¸ì ì •ë³´ì™€ ë™ì¼(ì´ë¦„/ì—°ë½ì²˜)
            </label>
            <span class="muted" style="font-size:12px;">(ì²´í¬í•˜ë©´ ìë™ ì…ë ¥ë©ë‹ˆë‹¤)</span>
          </div>

          <div class="form">
            <div>
              <label>ìˆ˜ë ¹ì¸ ì´ë¦„ *</label>
              <input type="text" id="recvName" placeholder="ì˜ˆ) ê¹€ì² ìˆ˜">
            </div>
            <div>
              <label>ìˆ˜ë ¹ì¸ ì—°ë½ì²˜ *</label>
              <input type="tel" id="recvPhone" placeholder="ì˜ˆ) 010-0000-0000">
            </div>

            <div>
              <label>ìš°í¸ë²ˆí˜¸ *</label>
              <input type="text" id="zip" readonly placeholder="ì£¼ì†Œ ê²€ìƒ‰ìœ¼ë¡œ ìë™ì…ë ¥">
            </div>
            <div>
              <label>&nbsp;</label>
              <button class="btn" id="addrSearchBtn" type="button" style="width:100%;">ì£¼ì†Œ ê²€ìƒ‰</button>
            </div>

            <div style="grid-column:1 / -1;">
              <label>ê¸°ë³¸ì£¼ì†Œ(ë„ë¡œëª…/ì§€ë²ˆ) *</label>
              <input type="text" id="addr1" readonly placeholder="ì£¼ì†Œ ê²€ìƒ‰ìœ¼ë¡œ ìë™ì…ë ¥">
            </div>
            <div style="grid-column:1 / -1;">
              <label>ìƒì„¸ì£¼ì†Œ *</label>
              <input type="text" id="addr2" placeholder="ì˜ˆ) 101ë™ 1203í˜¸">
            </div>
          </div>

          <!-- PCìš© ì¸ë¼ì¸ ì£¼ì†Œë ˆì´ì–´ -->
          <div class="addrLayer" id="addrLayer"></div>
          <div class="help" id="addrHelp"></div>

          <div class="divider"></div>

          <div class="sumBox">
            <div class="sumRow"><span class="muted">í˜„ì¬ ë°°ì†¡ë¹„</span><strong id="shipFeeNow">0ì›</strong></div>
            <div class="miniHint" id="shipReasonNow"></div>
          </div>

          <div class="divider"></div>

          <div class="row" style="justify-content:space-between;">
            <button class="btn" id="backTo2">ì´ì „</button>
            <button class="btn primary" id="toStep4" disabled>ë‹¤ìŒ</button>
          </div>
        </div>

        <div class="section" id="section4">
          <h2 style="margin:0;font-size:15px;letter-spacing:-.1px;">ìµœì¢… í™•ì¸</h2>
          <div class="muted" style="font-size:12px;margin-top:6px;">ìš”ì•½ì„ í™•ì¸í•˜ê³  ì œì¶œí•˜ì„¸ìš”.</div>

          <div class="divider"></div>

          <div class="cartList" id="cartList"></div>

          <div class="divider"></div>

          <div class="sumBox">
            <div class="sumRow"><span class="muted">ìƒí’ˆ í•©ê³„</span><strong id="itemsTotal2">0ì›</strong></div>
            <div class="sumRow"><span class="muted">ë°°ì†¡ë¹„</span><strong id="shipFeeLine2">0ì›</strong></div>
            <div class="sumRow"><span>ì´ ê²°ì œê¸ˆì•¡(ë°°ì†¡ë¹„ í¬í•¨)</span><strong id="grandTotal2">0ì›</strong></div>
            <div class="miniHint" id="shipReason2" style="margin-top:8px;"></div>
          </div>

          <div class="divider"></div>

          <div class="accountBox">
            <p class="title">ì…ê¸ˆ ì•ˆë‚´</p>
            <p class="text">
              ì•„ë˜ ê³„ì¢Œë¡œ ì…ê¸ˆí•´ì£¼ì„¸ìš”.<br>
              <b>ì…ê¸ˆê³„ì¢Œ: ìš°ë¦¬ì€í–‰/ 2656-3515-618154/ ê°œì¸êµ¬ë§¤ ì£¼ì‹íšŒì‚¬ ë„ë£¨ì½”</b><br>
              <b>ì…ê¸ˆìëŠ” ì£¼ë¬¸ìì™€ ë™ì¼í•´ì•¼ í•©ë‹ˆë‹¤.</b><br>
            </p>
          </div>

          <div class="divider"></div>

          <label>ë¹„ê³ </label>
          <textarea id="note" placeholder="ì˜ˆ) ë¬¸ ì•ì— ë†“ì•„ì£¼ì„¸ìš” / ë¶€ì¬ ì‹œ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤."></textarea>

          <div class="divider"></div>

          <div class="row" style="justify-content:space-between;">
            <button class="btn" id="backTo3">ì´ì „</button>
            <button class="btn primary" id="submitBtn">ì œì¶œ ì „ ìš”ì•½ ë³´ê¸°</button>
          </div>

          <div class="help">ì œì¶œ í›„ì—ëŠ” ê´€ë¦¬ì(ì˜ì—…ì§€ì›ë¶€ì„œ)ê°€ ìŠ¹ì¸ ì ˆì°¨ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.</div>
        </div>

      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <!-- ================================================================
       ê²Œì´íŠ¸ ëª¨ë‹¬ (í•„ìˆ˜ ì•ˆë‚´ / ê°œì¸ì •ë³´ ë™ì˜)
       [ê°œì„  1] ë§ˆê° ì‹œ: ì „ì²´ ì•ˆë‚´ ë¸”ë¡ìœ¼ë¡œ ì¦‰ì‹œ ë§ˆê° ì•ˆë‚´ í‘œì‹œ
       ================================================================ -->
  <div class="backdrop open" id="gateBackdrop" aria-hidden="false">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="gateTitle">
      <div class="modalHeader">
        <h3 id="gateTitle">ì£¼ë¬¸ ì „ í•„ìˆ˜ ì•ˆë‚´</h3>
        <span class="status err" id="gateStatus">ìŠ¤í¬ë¡¤ í™•ì¸ í•„ìš”</span>
      </div>
      <div class="modalBody">

        <!-- [ê°œì„  1] ë§ˆê° ì „ì²´ ì•ˆë‚´ ë°°ë„ˆ (ORDER_CLOSED=true ì‹œ JSë¡œ í‘œì‹œ) -->
        <div class="closedFullBanner" id="closedFullBanner" style="display:none;">
          <div class="closedIcon">ğŸ”’</div>
          <p class="closedTitle">í˜„ì¬ ì£¼ë¬¸ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤</p>
          <p class="closedMsg" id="closedFullMsg"></p>
        </div>

        <!-- ì •ì±… ë³¸ë¬¸: ë§ˆê° ì‹œ íë¦¬ê²Œ ì²˜ë¦¬ -->
        <div id="policySection">
          <div class="policy" id="policyBox">
<b>[í•„ìˆ˜ í™•ì¸ ì‚¬í•­]</b><br><br>

1) ë³¸ ì‚¬ë‚´êµ¬ë§¤ëŠ” <b>ì¬íŒë§¤ ë˜ëŠ” ì˜ë¦¬ ëª©ì  ì‚¬ìš©ì€ ê¸ˆì§€</b>ë˜ì–´ ìˆìŠµë‹ˆë‹¤.<br>
2) ì„¸ë²•ì— ì˜í•´ ì‚¬ë‚´êµ¬ë§¤ ì—°ê°„ êµ¬ë§¤ê¸ˆì•¡ì€ <b>200ë§Œì› ì´ë‚´ë¡œ ì œí•œ</b>ë©ë‹ˆë‹¤.<br>
3) ì‹ ì²­í•œ ë¬¼í’ˆì€ ë‚´ë¶€ ê¸°ì¤€ì— ë”°ë¼ <b>ìŠ¹ì¸ ë˜ëŠ” ë°˜ë ¤</b>ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
4) ì¶œê³ ëŠ” <b>íƒë°° ë°œì†¡</b>ì´ë©° ê¸°ë³¸ ë¬´ë£Œì´ë‚˜, ìš°í¸ë²ˆí˜¸ ê¸°ì¤€ <b>ì œì£¼/ë„ì„œì‚°ê°„</b> ì§€ì—­ì€ ì¶”ê°€ ë°°ì†¡ë¹„ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
5) ìˆ˜ë ¹ì, ì£¼ì†Œ, ì—°ë½ì²˜ ì˜¤ë¥˜ë¡œ ì¸í•œ ë°°ì†¡ ë¬¸ì œëŠ” ì¬ë°œì†¡ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
6) ì…ë ¥ ì •ë³´ëŠ” ì£¼ë¬¸ ì²˜ë¦¬ ëª©ì ì— í•œí•´ ì‚¬ìš©ë©ë‹ˆë‹¤.<br><br>

ìœ„ ë‚´ìš©ì„ í™•ì¸í–ˆìœ¼ë©°, ì •í™•í•œ ì •ë³´ë¥¼ ì…ë ¥í•˜ê² ìŠµë‹ˆë‹¤.<br><br>

<hr>

<b>[ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜]</b><br><br>

ì£¼ì‹íšŒì‚¬ ë„ë£¨ì½”(ì´í•˜ "íšŒì‚¬")ëŠ” ã€Œê°œì¸ì •ë³´ë³´í˜¸ë²•ã€ ì œ15ì¡° ì œ1í•­ì— ë”°ë¼ ì•„ë˜ì™€ ê°™ì´ ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘Â·ì´ìš©í•©ë‹ˆë‹¤.<br>
ë‹¨, ê³„ì•½ì´ ì²´ê²°ë˜ì§€ ì•Šì€ ê²½ìš° ìˆ˜ì§‘ëœ ê°œì¸ì •ë³´ëŠ” ì¦‰ì‹œ íŒŒê¸°ë©ë‹ˆë‹¤.<br><br>

<b>1. ìˆ˜ì§‘ í•­ëª©</b><br>
- ì„±ëª…, ì‚¬ë²ˆ, ì£¼ì†Œ, ì—°ë½ì²˜(íœ´ëŒ€ì „í™”ë²ˆí˜¸ ë“±)<br>
- ìƒí’ˆ êµ¬ë§¤ì •ë³´, ë°°ì†¡ ì •ë³´(ìˆ˜ë ¹ì¸ëª…, ì£¼ì†Œ ë“±)<br><br>

<b>2. ì´ìš© ëª©ì </b><br>
- ì£¼ë¬¸ ì²˜ë¦¬ ë° ë³¸ì¸ ì˜ì‚¬ í™•ì¸<br>
- ê³ ê° ìƒë‹´ ë° ë¶€ì • ì´ìš© ë°©ì§€<br>
- ë¬¼í’ˆ ë°°ì†¡ ë° ì•ˆë‚´ ì‚¬í•­ ì „ë‹¬<br><br>

<b>3. ë³´ìœ  ê¸°ê°„</b><br>
- ê°œì¸ì •ë³´ëŠ” ì´ìš© ëª©ì  ë‹¬ì„± ì‹œê¹Œì§€ ë³´ê´€ í›„ ì¦‰ì‹œ ì‚­ì œë©ë‹ˆë‹¤.<br><br>

ê·€í•˜ëŠ” ê°œì¸ì •ë³´ ì œê³µì„ ê±°ë¶€í•  ê¶Œë¦¬ê°€ ìˆìœ¼ë©°, ê±°ë¶€ ì‹œ ì£¼ë¬¸ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><br>

<b>â€» ì•„ë˜ê¹Œì§€ ìŠ¤í¬ë¡¤í•˜ì—¬ ì „ì²´ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</b>
          </div>

          <div class="checkRow">
            <input type="checkbox" id="agreeChk" disabled>
            <div>
              <b>ìœ„ ì•ˆë‚´ì‚¬í•­ì„ ëª¨ë‘ ì½ì—ˆê³  ë™ì˜í•©ë‹ˆë‹¤.</b><br>
              <span class="muted" style="font-size:12px;">ìŠ¤í¬ë¡¤ ì™„ë£Œ í›„ ì²´í¬ê°€ í™œì„±í™”ë©ë‹ˆë‹¤.</span>
            </div>
          </div>
        </div>

      </div>
      <div class="modalFooter">
        <button class="btn primary" id="startBtn" disabled>ì‹œì‘í•˜ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ìš”ì•½ ëª¨ë‹¬ -->
  <div class="backdrop" id="summaryBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="summaryTitle">
      <div class="modalHeader">
        <h3 id="summaryTitle">ì œì¶œ ìš”ì•½</h3>
        <button class="btn" id="closeSummaryBtn">ë‹«ê¸°</button>
      </div>

      <div class="modalBody">
        <div class="card" style="box-shadow:none;">
          <div class="cardBody" style="padding:12px;">
            <div class="kvs" id="summaryKV"></div>
          </div>
        </div>

        <div class="card" style="box-shadow:none;margin-top:10px;">
          <div class="cardBody" style="padding:12px;">
            <table>
              <thead>
                <tr>
                  <th>ì¹´í…Œê³ ë¦¬</th>
                  <th>ìƒí’ˆ</th>
                  <th style="text-align:right;">ë‹¨ê°€</th>
                  <th style="text-align:right;">ìˆ˜ëŸ‰</th>
                  <th style="text-align:right;">í•©ê³„</th>
                </tr>
              </thead>
              <tbody id="summaryItems"></tbody>
              <tfoot>
                <tr class="tfoot">
                  <td colspan="4" style="text-align:right;">ìƒí’ˆ í•©ê³„</td>
                  <td id="summaryItemsTotal" style="text-align:right;"></td>
                </tr>
                <tr class="tfoot">
                  <td colspan="4" style="text-align:right;">ë°°ì†¡ë¹„</td>
                  <td id="summaryShipFee" style="text-align:right;"></td>
                </tr>
                <tr class="tfoot">
                  <td colspan="4" style="text-align:right;">ì´ ê²°ì œê¸ˆì•¡(ì‹¤ê²°ì œ ì—†ìŒ)</td>
                  <td id="summaryGrandTotal" style="text-align:right;"></td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>

        <div class="help">ì‹œìŠ¤í…œ ìƒ ì…ê¸ˆ í›„ì—ëŠ” ì·¨ì†Œ ë° í™˜ë¶ˆì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹ ì¤‘íˆ ê²°ì • í›„ ì…ê¸ˆ ë°”ëë‹ˆë‹¤.</div>
      </div>

      <div class="modalFooter">
        <span class="status" id="sendStatus">ì „ì†¡ ëŒ€ê¸°</span>
        <button class="btn" id="copyJsonBtn" style="display:none;">JSON ë³µì‚¬</button>
        <button class="btn primary" id="confirmSendBtn">ìµœì¢… ì œì¶œ</button>
      </div>
    </div>
  </div>

  <!-- [ê°œì„  3] ëª¨ë°”ì¼ ì£¼ì†Œ ê²€ìƒ‰ ì „ìš© ëª¨ë‹¬ -->
  <div class="backdrop" id="addrMobileBackdrop" aria-hidden="true" style="padding:0;">
    <div class="modal" style="width:100%;max-width:100%;height:100%;max-height:100%;border-radius:0;display:flex;flex-direction:column;">
      <div class="modalHeader" style="flex:0 0 auto;">
        <h3>ì£¼ì†Œ ê²€ìƒ‰</h3>
        <button class="btn" id="addrMobileCloseBtn">ë‹«ê¸°</button>
      </div>
      <div style="flex:1 1 auto;overflow:hidden;position:relative;">
        <div class="addrModalLayer" id="addrMobileLayer" style="height:100%;"></div>
      </div>
    </div>
  </div>

  <!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
  <div class="backdrop" id="imgPreview">
    <div class="modal" style="max-width:520px;">
      <div class="modalHeader">
        <h3 id="imgPreviewTitle"></h3>
        <button class="btn" onclick="closeImagePreview()">ë‹«ê¸°</button>
      </div>
      <div class="modalBody" style="text-align:center;">
        <img id="imgPreviewTarget" style="max-width:100%;border-radius:12px;">
        <div id="imgPreviewText" style="margin-top:10px;text-align:left;font-size:13px;line-height:1.5;color:var(--muted);white-space:pre-line;"></div>
      </div>
    </div>
  </div>

  <script>
    const ORDER_CLOSED = true;
    const ORDER_CLOSED_MSG = "í˜„ì¬ ì£¼ë¬¸ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤. (2026 ì„¤ë§ì´ ì„ì§ì› êµ¬ë§¤ ì‹ ì²­ ì¢…ë£Œ)\në‹¤ìŒ ì‹ ì²­ ì¼ì •ì€ ì‚¬ë‚´ ê³µì§€ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.";

    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzm2Yjy6K5hj8o79IL-_YTgMyD7VTi9VO0JJEfhOzo42rHOhOhTAMpeOPO5chpggPLW/exec";

    const MIN_ORDER_AMOUNT = 20000;

    const MAX_QTY_PER_ITEM = 100;
    const ITEM_MAX_QTY = { "KT-02": 1 };
    const getItemMaxQty = (productId)=> ITEM_MAX_QTY[productId] ?? MAX_QTY_PER_ITEM;

    const SHIPPING_BASE_FEE = 0;
    const SHIPPING_JEJU_FEE = 3000;
    const SHIPPING_ISLAND_FEE = 5000;

    const ZIP_RULES = [
      { type: "jeju", ranges: [[63000, 63644]] },
      { type: "island", ranges: [
        [22386, 22388],[23004, 23010],[23100, 23116],[23124, 23136],[31708, 31708],[32133, 32133],[33411, 33411],
        [40200, 40240],[46768, 46771],[52570, 52571],[53031, 53033],[53089, 53104],[54000, 54000],[56347, 56349],
        [57068, 57069],[58760, 58762],[58800, 58810],[58816, 58818],[28826, 28826],[58828, 58866],[58953, 58958],
        [59102, 59103],[59106, 59106],[59127, 59127],[59129, 59129],[59137, 59166],[59650, 59650],[59766, 59766],
        [59781, 59790],
      ]},
    ];

    const CATEGORIES = [
      { key: "ë©´ë„ê¸°", label: "ë©´ë„ê¸°" },
      { key: "ì£¼ë°©ìš©í’ˆ", label: "ì£¼ë°©ìš©í’ˆ" },
      { key: "ì¿¡ì›¨ì–´", label: "ì¿¡ì›¨ì–´" },
    ];

    const PRODUCTS = [
      { id:"RZ-01", category:"ë©´ë„ê¸°", name:"í„°ì¹˜3 íœ´ëŒ€ìš©ë©´ë„ê¸° 2ì…", price:4000, desc:"2ì… x 20ê°œ êµ¬ì„±", detail:"", longDesc:"Touch3 íœ´ëŒ€ìš© ë©´ë„ê¸° 2ì…", image:"RZ-01.jpg", discount: 88, soldOut: false, packQty: "x20" },
      { id:"RZ-02", category:"ë©´ë„ê¸°", name:"í˜ì´ìŠ¤6 ê³¨ë“œê¸°íš 2í˜¸", price:10000, desc:"10SET êµ¬ì„±", detail:"", longDesc:"1) PACE6 ë©´ë„ê¸°(ë‚ í¬í•¨) 1ea\n2) PACE6 ë©´ë„ë‚  4ea\n\nPACEì‹œìŠ¤í…œ ì „ì œí’ˆ í˜¸í™˜ ê°€ëŠ¥", image:"RZ-02.jpg", discount: 90, soldOut: false, packQty: "x10" },
      { id:"RZ-03", category:"ë©´ë„ê¸°", name:"í˜ì´ìŠ¤3D ëª¨ì…˜ í™ˆì‡¼í•‘ê¸°íš 4í˜¸ 1+1", price:10000, desc:"í¼ ìœ í†µê¸°í•œ: 26ë…„ 4ì›”", detail:"", longDesc:"1) 3Dëª¨ì…˜ ë©´ë„ê¸°(ë‚ í¬í•¨) 1ea\n2) 3Dëª¨ì…˜ ë©´ë„ë‚  11ea\n3) ë„¤ì´ë¹„ ìŠ¤íƒ ë“œ 1ea\n4) PACE ì•„ì¿ ì•„ ì‰ì´ë¹™í¼ 250ml 1ea\n\ní¼ ìœ í†µê¸°í•œ: 26ë…„ 4ì›”", image:"RZ-03.jpg", discount: 92, soldOut: false, packQty: "1+1" },
      { id:"RZ-04", category:"ë©´ë„ê¸°", name:"ì´ë¸Œ í¬ë¦¬ë¯¸ ê¸°íšì„¸íŠ¸ 2í˜¸ 1+1", price:5000, desc:"", detail:"í¼ ìœ í†µê¸°í•œ: 26ë…„ 4ì›”", longDesc:"1) ì´ë¸Œ í¬ë¦¬ë¯¸ ë©´ë„ê¸°(ë‚ í¬í•¨) 1ea\n2) ìƒ¤ì´ í¬ë¦¬ë¯¸ ë©´ë„ë‚  1ea\n3) ìƒ¤ì´ ì‹¬í”Œ ëˆˆì¹ë©´ë„ê¸° 3ea\n4) ìƒ¤ì´ ë¹„í‚¤ë‹ˆ ë©´ë„ê¸° 1ea\n5) í˜ì´ìŠ¤ í”„ë ˆì‰¬ í¼ 250ml 1ea\n\ní¼ ìœ í†µê¸°í•œ: 26ë…„ 4ì›”", image:"RZ-04.jpg", discount: 90, soldOut: false, packQty: "1+1" },
      { id:"RZ-05", category:"ë©´ë„ê¸°", name:"ìŠ¬ë¦­ëª¨ì…˜ ì˜¨ë¼ì¸ ê¸°íšì„¸íŠ¸1í˜¸", price:25000, desc:"", detail:"", longDesc:"1) ìŠ¬ë¦­ëª¨ì…˜ ë©´ë„ê¸°(ë‚ í¬í•¨) 1ea\n2) ë©´ë„ë‚  9ea", image:"RZ-05.jpg", discount: 54, soldOut: false },

      { id:"KT-01", category:"ì£¼ë°©ìš©í’ˆ", name:"ì¸í…Œë¦¬ì–´ ë¼ì„ ê¸°íšì„¸íŠ¸ 1í˜¸", price:25000, desc:"-", detail:"", longDesc:"1) ì¸í…Œë¦¬ì–´ ë‹¤ìš©ë„ì‹ë„ 190mm(ë¼ì„) 1ea\n2) ì¸í…Œë¦¬ì–´ ì•¼ì±„ìš©ì‹ë„ 170mm(ë¼ì„) 1ea\n3) ì¸í…Œë¦¬ì–´ ê³¼ë„ 120mm(ë¼ì„) 1ea\n4) ì¸í…Œë¦¬ì–´ ê°€ìœ„ 110S(ë¼ì„) 1ea", image:"KT-01.jpg", discount: 74, soldOut: false },
      { id:"KT-02", category:"ì£¼ë°©ìš©í’ˆ", name:"ë‰´í´ë˜ì‹ ë¼ì´íŠ¸ íŠ¹íŒì„¸íŠ¸ 1í˜¸ 1+1", price:20000, desc:"í•œì •íŒë§¤ 85ì„¸íŠ¸", detail:"1ì¸ 1ê°œ í•œì • íŒë§¤", longDesc:"1) ë² ì´ì§ ê°€ìœ„ 120S 1ea\n2) ë‰´í´ë˜ì‹ë¼ì´íŠ¸ ë‹¤ìš©ë„ì‹ë„ 200mm 1ea\n3) ë‰´í´ë˜ì‹ ë¼ì´íŠ¸ ì•¼ì±„ìš©ì‹ë„ 165mm 1ea\n\nâ˜…í•œì •íŒë§¤ 85ì„¸íŠ¸", image:"KT-02.jpg", discount: 85, soldOut: true, packQty: "1+1" },
      { id:"KT-03", category:"ì£¼ë°©ìš©í’ˆ", name:"í´ë˜ì‹ í‚¤ì¹œíˆ´ 4ì¢… ì„¸íŠ¸", price:10000, desc:"í•œì •íŒë§¤ 280ì„¸íŠ¸", detail:"", longDesc:"1) í´ë˜ì‹ ì‚¼ê° ë’¤ì§€ê°œ 1ea\n2) í´ë˜ì‹ ë©´êµ­ì 1ea\n3) í´ë˜ì‹ ìš”ë¦¬ìŠ¤í‘¼(ì¤‘) 1ea\n4) í´ë˜ì‹ ë’¤ì§€ê°œ 1ea\n\nâ˜…í•œì •íŒë§¤ 280ì„¸íŠ¸", image:"KT-03.jpg", discount: 79, soldOut: false },
      { id:"KT-04", category:"ì£¼ë°©ìš©í’ˆ", name:"í´ë˜ì‹ í‚¤ì¹œíˆ´ 3ì¢… ì„¸íŠ¸", price:3000, desc:"-", detail:"", longDesc:"1) í´ë˜ì‹ ì‚¼ê° ë’¤ì§€ê°œ 1ea\n2) í´ë˜ì‹ ë©´êµ­ì 1ea\n3) í´ë˜ì‹ ìš”ë¦¬ìŠ¤í‘¼(ì¤‘) 1ea", image:"KT-04.jpg", discount: 91, soldOut: false },

      { id:"CW-01", category:"ì¿¡ì›¨ì–´", name:"í¬ë ˆìŠ¤íƒ€ ì‹œì¦Œ3 IH 7ì¢…ì„¸íŠ¸", price:50000, desc:"-", detail:"", longDesc:"1) í¬ë ˆìŠ¤íƒ€ IH í¸ìˆ˜ 20cm 1ea\n2) í¬ë ˆìŠ¤íƒ€ IH í”„ë¼ì´íŒ¬ 28cm 2ea\n3) í¬ë ˆìŠ¤íƒ€ IH ê¶ì¤‘íŒ¬ 26cm 1ea\n4) í¬ë ˆìŠ¤íƒ€ IH ì „ê³¨íŒ¬ 26cm 1ea\n5) ìœ ë¦¬ëšœê»‘ 20cm 1ea\n6) ìœ ë¦¬ëšœê»‘ 26cm 1ea\n7) ì¦ì •í’ˆ ê·€ë¦¬ìŒ€ (í¬ì¥ì¼ 2023ë…„)", image:"CW-01.jpg", discount: 69, soldOut: false },
      { id:"CW-02", category:"ì¿¡ì›¨ì–´", name:"ì• ì‰¬ë¸”ë£¨ IH í”„ë¼ì´íŒ¬ 2ì¢… ì„¸íŠ¸ 1í˜¸", price:10000, desc:"", detail:"ë°•ìŠ¤ ë¯¸ì„¸í ì§‘ ê°€ëŠ¥", longDesc:"1) ì• ì‰¬ë¸”ë£¨ í”„ë¼ì´íŒ¬ 24cm 1ea\n2) ì• ì‰¬ë¸”ë£¨ í”„ë¼ì´íŒ¬ 28cm 1ea \në³¸ ìƒí’ˆì€ íŠ¹ê°€ íŒë§¤ ìƒí’ˆìœ¼ë¡œ, ë°•ìŠ¤ ìƒíƒœì— ê²½ë¯¸í•œ í ì§‘ì´ë‚˜ ëˆŒë¦¼ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë©°, í•´ë‹¹ ì‚¬ìœ ë¡œ êµí™˜/ë°˜í’ˆì€ ì–´ë µìŠµë‹ˆë‹¤.", image:"CW-02.jpg", discount: 83, soldOut: true },
    ];

    const state = {
      activeCategory: CATEGORIES[0].key,
      cart: new Map(),
      shipFee: SHIPPING_BASE_FEE,
      shipFeeReason: "ê¸°ë³¸ ë¬´ë£Œë°°ì†¡",
      policyRead: false
    };

    const el = (id) => document.getElementById(id);
    const fmt = (n) => new Intl.NumberFormat("ko-KR").format(n);

    function toast(msg){
      const t = el("toast");
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"), 1600);
    }

    const zipToInt = (zip)=>{
      const n = parseInt(String(zip || "").replace(/\D/g, ""), 10);
      return Number.isFinite(n) ? n : null;
    };
    const matchZip = (zipInt, ranges)=> ranges.some(([s,e])=> zipInt>=s && zipInt<=e);

    function shippingByZip(zip){
      const z = zipToInt(zip);
      if (z === null) return { fee: SHIPPING_BASE_FEE, reason: "ê¸°ë³¸ ë¬´ë£Œë°°ì†¡" };
      const jejuRule = ZIP_RULES.find(r => r.type === "jeju");
      if (jejuRule && matchZip(z, jejuRule.ranges)) return { fee: SHIPPING_JEJU_FEE, reason: "ì œì£¼ ì¶”ê°€ë°°ì†¡ë¹„" };
      const islandRule = ZIP_RULES.find(r => r.type === "island");
      if (islandRule && matchZip(z, islandRule.ranges)) return { fee: SHIPPING_ISLAND_FEE, reason: "ë„ì„œì‚°ê°„ ì¶”ê°€ë°°ì†¡ë¹„" };
      return { fee: SHIPPING_BASE_FEE, reason: "ê¸°ë³¸ ë¬´ë£Œë°°ì†¡" };
    }

    const calcItemsTotal = ()=> {
      let total = 0;
      for (const {product, qty} of state.cart.values()) total += product.price * qty;
      return total;
    };
    const calcGrandTotal = ()=> calcItemsTotal() + state.shipFee;
    const minOrderOk = ()=> calcItemsTotal() >= MIN_ORDER_AMOUNT;

    function setStep(active){
      ["1","2","3","4"].forEach(n=>{
        el("step"+n).classList.toggle("active", n===String(active));
        el("section"+n).classList.toggle("active", n===String(active));
      });
      window.scrollTo({top:0,behavior:"smooth"});
    }

    function validateStepButtons(){
      const itemsTotal = calcItemsTotal();
      const minOk = itemsTotal >= MIN_ORDER_AMOUNT;

      el("toStep2").disabled = !(state.cart.size > 0 && minOk);

      const ordererOk =
        el("ordererName").value.trim() &&
        el("ordererEmpId").value.trim() &&
        el("ordererPhone").value.trim() &&
        el("ordererDept").value.trim();

      el("toStep3").disabled = !(state.cart.size > 0 && minOk && ordererOk);

      const recvOk = el("recvName").value.trim() && el("recvPhone").value.trim();
      const addrOk = el("zip").value.trim() && el("addr1").value.trim() && el("addr2").value.trim();
      el("toStep4").disabled = !(state.cart.size > 0 && minOk && ordererOk && recvOk && addrOk);

      el("clearCartBtn").disabled = !(state.cart.size > 0);
      el("submitBtn").disabled = !(state.cart.size > 0 && minOk);
    }

    function recalcShipping(){
      const ship = shippingByZip(el("zip").value);
      state.shipFee = ship.fee;
      state.shipFeeReason = ship.reason;
      renderTotals();
      validateStepButtons();
    }

    function renderTabs(){
      const wrap = el("tabs");
      wrap.innerHTML = "";
      for (const c of CATEGORIES){
        const b = document.createElement("button");
        b.className = "tab" + (c.key === state.activeCategory ? " active" : "");
        b.textContent = c.label;
        b.onclick = ()=>{ state.activeCategory = c.key; renderTabs(); renderProducts(); };
        wrap.appendChild(b);
      }
    }

    const getDiscountChipText = (p)=>{
      const d = Number(p.discount);
      return Number.isFinite(d) && d > 0 ? `${d}% í• ì¸` : "";
    };

    function renderProducts(){
      const wrap = el("products");
      wrap.innerHTML = "";
      const list = PRODUCTS.filter(p=>p.category===state.activeCategory);

      for (const p of list){
        const card = document.createElement("div");
        card.className = "product";

        const top = document.createElement("div");
        top.className = "productTop";

        const thumb = document.createElement("div");
        thumb.className = "thumb";

        if (p.image){
          const img = document.createElement("img");
          img.src = p.image;
          img.alt = p.name;
          img.loading = "lazy";
          img.style.cursor = "pointer";
          img.onerror = () => { thumb.innerHTML = `<div class="ph">IMG</div>`; };
          img.onclick = ()=>openImagePreview(p.image, p.name, (p.longDesc || p.detail || p.desc || "").trim());
          thumb.appendChild(img);

          if (p.packQty){
            const b = document.createElement("div");
            b.className = "qtyBadge red";
            b.textContent = p.packQty;
            thumb.appendChild(b);
          }
        } else {
          thumb.innerHTML = `<div class="ph">IMG</div>`;
        }

        const info = document.createElement("div");
        info.className = "productInfo";

        const name = document.createElement("p");
        name.className = "productName";
        name.textContent = p.name;

        const pid = document.createElement("p");
        pid.className = "productId";
        pid.textContent = p.id;

        info.appendChild(name);
        info.appendChild(pid);

        const chips = document.createElement("div");
        chips.className = "chips";

        const isSoldOut = (p.soldOut === true);

        if (isSoldOut){
          const s = document.createElement("span");
          s.className = "chip soldout";
          s.textContent = "SOLD OUT";
          chips.appendChild(s);
          card.classList.add("isSoldout");
        }

        const disc = getDiscountChipText(p);
        if (disc){
          const c = document.createElement("span");
          c.className = "chip off";
          c.textContent = disc;
          chips.appendChild(c);
        }

        if (chips.childElementCount > 0) info.appendChild(chips);

        const metaParts = [p.desc, p.detail].filter(Boolean).map(s=>String(s).trim()).filter(Boolean);
        if (metaParts.length){
          const expiryParts = metaParts.filter(t => /í¼\s*ìœ í†µê¸°í•œ/i.test(t));
          const normalParts = metaParts.filter(t => !/í¼\s*ìœ í†µê¸°í•œ/i.test(t));
          const meta = document.createElement("p");
          meta.className = "productMeta";
          const normalText = normalParts.join(" Â· ").trim();
          if (normalText){ const s = document.createElement("span"); s.textContent = normalText; meta.appendChild(s); }
          if (expiryParts.length){
            if (normalText) meta.appendChild(document.createElement("br"));
            const e = document.createElement("span");
            e.className = "expiry";
            e.textContent = expiryParts.join(" / ");
            meta.appendChild(e);
          }
          info.appendChild(meta);
        }

        const priceLine = document.createElement("div");
        priceLine.className = "priceLine";
        priceLine.textContent = `${fmt(p.price)}ì›`;

        top.appendChild(thumb);
        top.appendChild(info);
        top.appendChild(priceLine);

        const row = document.createElement("div");
        row.className = "row";
        row.style.justifyContent = "space-between";

        const qtyWrap = document.createElement("div");
        qtyWrap.className = "row";

        const qty = document.createElement("input");
        qty.type="number"; qty.min="1"; qty.max=String(getItemMaxQty(p.id)); qty.step="1"; qty.value="1"; qty.className="qty";
        if (isSoldOut) qty.disabled = true;

        const btn = document.createElement("button");
        btn.className="btn primary";
        btn.textContent = isSoldOut ? "í’ˆì ˆ" : "ë‹´ê¸°";
        btn.disabled = isSoldOut;

        btn.onclick = ()=>{
          const max = getItemMaxQty(p.id);
          const raw = parseInt(qty.value || "1", 10);
          const requested = Number.isFinite(raw) ? Math.max(1, raw) : 1;
          const curQty = state.cart.get(p.id)?.qty || 0;
          const addable = Math.max(0, max - curQty);
          if (addable === 0) { toast(`í•´ë‹¹ í’ˆëª©ì€ ìµœëŒ€ ${max}ê°œê¹Œì§€ ì£¼ë¬¸ ê°€ëŠ¥í•©ë‹ˆë‹¤`); return; }
          const willAdd = Math.min(requested, addable);
          const msg = (requested > willAdd)
            ? `ìš”ì²­ ${requested}ê°œ ì¤‘ ${willAdd}ê°œë§Œ ë‹´ê²¼ìŠµë‹ˆë‹¤ (ìµœëŒ€ ${max}ê°œ)`
            : "ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìŠµë‹ˆë‹¤";
          addToCart(p.id, willAdd, { toastMsg: msg });
        };

        qtyWrap.appendChild(qty);
        qtyWrap.appendChild(btn);
        row.appendChild(qtyWrap);

        card.appendChild(top);
        card.appendChild(row);
        wrap.appendChild(card);
      }
    }

    function addToCart(productId, qty, opts = {}){
      const product = PRODUCTS.find(x=>x.id===productId);
      if(!product) return;
      if(product.soldOut === true){ toast("í’ˆì ˆëœ ìƒí’ˆì…ë‹ˆë‹¤"); return; }
      const max = getItemMaxQty(productId);
      const curQty = state.cart.get(productId)?.qty || 0;
      const nextQty = Math.min(max, curQty + qty);
      if(nextQty === curQty){ toast(`í•´ë‹¹ í’ˆëª©ì€ ìµœëŒ€ ${max}ê°œê¹Œì§€ ì£¼ë¬¸ ê°€ëŠ¥í•©ë‹ˆë‹¤`); return; }
      state.cart.set(productId, {product, qty: nextQty});
      toast(opts.toastMsg || "ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìŠµë‹ˆë‹¤");
      renderCartForStep4();
      renderCartPreview();
      renderTotals();
      validateStepButtons();
    }

    function changeQty(productId, delta){
      const p = PRODUCTS.find(x=>x.id===productId);
      if(delta > 0 && p && p.soldOut === true){ toast("í’ˆì ˆëœ ìƒí’ˆì…ë‹ˆë‹¤"); return; }
      if(!state.cart.has(productId)) return;
      const cur = state.cart.get(productId);
      const max = getItemMaxQty(productId);
      if (delta > 0 && cur.qty >= max){ toast(`í•´ë‹¹ í’ˆëª©ì€ ìµœëŒ€ ${max}ê°œê¹Œì§€ ì£¼ë¬¸ ê°€ëŠ¥í•©ë‹ˆë‹¤`); return; }
      cur.qty += delta;
      if(cur.qty > max){ cur.qty = max; toast(`í•´ë‹¹ í’ˆëª©ì€ ìµœëŒ€ ${max}ê°œê¹Œì§€ ì£¼ë¬¸ ê°€ëŠ¥í•©ë‹ˆë‹¤`); }
      if(cur.qty<=0) state.cart.delete(productId);
      else state.cart.set(productId, cur);
      renderCartForStep4();
      renderCartPreview();
      renderTotals();
      validateStepButtons();
    }

    function clearCart(){
      state.cart.clear();
      renderCartForStep4();
      renderCartPreview();
      renderTotals();
      validateStepButtons();
      toast("ì¥ë°”êµ¬ë‹ˆë¥¼ ë¹„ì› ìŠµë‹ˆë‹¤");
      setStep(1);
    }

    /* ================================================================
       [ê°œì„  2] ìµœì†Œ ì£¼ë¬¸ ê¸ˆì•¡ í”„ë¡œê·¸ë ˆìŠ¤ ë°” ë Œë”ë§
       ================================================================ */
    function renderMinOrderBar(itemsTotal){
      const pct = Math.min(100, Math.round((itemsTotal / MIN_ORDER_AMOUNT) * 100));
      const fill = el("minBarFill");
      fill.style.width = pct + "%";
      fill.classList.toggle("done", itemsTotal >= MIN_ORDER_AMOUNT);

      el("minBarCurrent").textContent = fmt(itemsTotal) + "ì›";
      el("minBarTarget").textContent = fmt(MIN_ORDER_AMOUNT) + "ì›";

      const msg = el("minBarMsg");
      if(itemsTotal >= MIN_ORDER_AMOUNT){
        msg.textContent = "âœ“ ìµœì†Œ ì£¼ë¬¸ ê¸ˆì•¡ ì¶©ì¡±ë˜ì—ˆìŠµë‹ˆë‹¤";
        msg.className = "minOrderBarMsg ok";
      } else {
        const remain = MIN_ORDER_AMOUNT - itemsTotal;
        msg.textContent = `${fmt(remain)}ì› ë” ë‹´ìœ¼ë©´ ì£¼ë¬¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤`;
        msg.className = "minOrderBarMsg";
      }
    }

    function renderTotals(){
      const itemsTotal = calcItemsTotal();
      const grandTotal = calcGrandTotal();

      el("itemsTotal").textContent = `${fmt(itemsTotal)}ì›`;
      el("grandTotal").textContent = `${fmt(grandTotal)}ì›`;
      el("itemsTotal2").textContent = `${fmt(itemsTotal)}ì›`;
      el("grandTotal2").textContent = `${fmt(grandTotal)}ì›`;

      el("shipFeeLine").textContent = `${fmt(state.shipFee)}ì›`;
      el("shipFeeLine2").textContent = `${fmt(state.shipFee)}ì›`;
      el("shipFeeNow").textContent = `${fmt(state.shipFee)}ì›`;
      el("topShipFee").textContent = `${fmt(state.shipFee)}ì›`;
      el("badgeShipFee").textContent = `${fmt(state.shipFee)}ì›`;

      const r = state.shipFeeReason ? `(${state.shipFeeReason})` : "";
      el("shipReason").textContent = r ? `â€» ${r}` : "";
      el("shipReason2").textContent = r ? `â€» ${r}` : "";
      el("shipReasonNow").textContent = r ? `â€» ${r}` : "";

      // [ê°œì„  2] í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì—…ë°ì´íŠ¸ (ê¸°ì¡´ minOrderHint ëŒ€ì²´)
      renderMinOrderBar(itemsTotal);
    }

    function renderCartPreview(){
      el("cartCount").textContent = String(state.cart.size);
      const wrap = el("cartPreview");
      wrap.innerHTML = "";

      if(state.cart.size===0){
        const d = document.createElement("div");
        d.className = "cartPreviewEmpty";
        d.textContent = "ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ìƒí’ˆì„ ë‹´ì•„ì£¼ì„¸ìš”.";
        wrap.appendChild(d);
        return;
      }

      for(const [id,{product,qty}] of state.cart.entries()){
        const max = getItemMaxQty(id);
        const plusDisabled = (qty >= max) || (product.soldOut === true);
        const item = document.createElement("div");
        item.className="cartItem";
        item.innerHTML = `
          <div style="min-width:0;">
            <p class="name">${product.name}</p>
            <p class="meta">${product.category} Â· ${product.id} Â· ë‹¨ê°€ ${fmt(product.price)}ì›</p>
          </div>
          <div style="text-align:right;">
            <div class="mini">
              <button class="miniBtn" type="button" data-minus="${id}">âˆ’</button>
              <div class="miniQty">${qty}</div>
              <button class="miniBtn" type="button" data-plus="${id}" ${plusDisabled ? "disabled" : ""}>+</button>
            </div>
            <div style="margin-top:6px;font-weight:900;">${fmt(product.price*qty)}ì›</div>
          </div>
        `;
        wrap.appendChild(item);
      }

      wrap.querySelectorAll("[data-minus]").forEach(b=>{ b.onclick = ()=>changeQty(b.dataset.minus, -1); });
      wrap.querySelectorAll("[data-plus]").forEach(b=>{ b.onclick = ()=>changeQty(b.dataset.plus, +1); });
    }

    function renderCartForStep4(){
      const wrap = el("cartList");
      wrap.innerHTML = "";
      if(state.cart.size===0){
        const d = document.createElement("div");
        d.className="sumBox";
        d.innerHTML = `<div class="muted" style="font-size:12px;">ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. 1ë‹¨ê³„ì—ì„œ ìƒí’ˆì„ ë‹´ì•„ì£¼ì„¸ìš”.</div>`;
        wrap.appendChild(d);
        return;
      }
      for(const [id,{product,qty}] of state.cart.entries()){
        const max = getItemMaxQty(id);
        const plusDisabled = (qty >= max) || (product.soldOut === true);
        const item = document.createElement("div");
        item.className="cartItem";
        item.innerHTML = `
          <div style="min-width:0;">
            <p class="name">${product.name}</p>
            <p class="meta">${product.category} Â· ${product.id} Â· ë‹¨ê°€ ${fmt(product.price)}ì›</p>
          </div>
          <div style="text-align:right;">
            <div class="mini">
              <button class="miniBtn" type="button" data-minus="${id}">âˆ’</button>
              <div class="miniQty">${qty}</div>
              <button class="miniBtn" type="button" data-plus="${id}" ${plusDisabled ? "disabled" : ""}>+</button>
            </div>
            <div style="margin-top:6px;font-weight:900;">${fmt(product.price*qty)}ì›</div>
          </div>
        `;
        wrap.appendChild(item);
      }
      wrap.querySelectorAll("[data-minus]").forEach(b=>{ b.onclick = ()=>changeQty(b.dataset.minus, -1); });
      wrap.querySelectorAll("[data-plus]").forEach(b=>{ b.onclick = ()=>changeQty(b.dataset.plus, +1); });
    }

    /* ================================================================
       [ê°œì„  3] ì£¼ì†Œ ê²€ìƒ‰: ëª¨ë°”ì¼/PC ë¶„ê¸°
       ================================================================ */
    const isMobile = ()=> window.innerWidth < 768;

    function openAddressSearchEmbed(){
      const help = el("addrHelp");
      help.textContent = "";

      if (!window.daum || !daum.Postcode){
        help.textContent = "ì£¼ì†Œ ê²€ìƒ‰ ì„œë¹„ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ì‚¬ë‚´ë§ì—ì„œ ì°¨ë‹¨ë˜ì—ˆì„ ìˆ˜ ìˆì–´ìš”) ìš°í¸ë²ˆí˜¸/ì£¼ì†Œë¥¼ ìˆ˜ë™ ì…ë ¥ìœ¼ë¡œ ì „í™˜í•´ì•¼ í•©ë‹ˆë‹¤.";
        toast("ì£¼ì†Œê²€ìƒ‰ ë¡œë“œ ì‹¤íŒ¨");
        return;
      }

      const onComplete = (data)=>{
        const addr = data.roadAddress || data.jibunAddress || "";
        el("zip").value = data.zonecode || "";
        el("addr1").value = addr;

        // ëª¨ë°”ì¼ ëª¨ë‹¬ ë‹«ê¸°
        if(isMobile()){
          closeMobileAddrModal();
          // [ê°œì„  3] ì£¼ì†Œ ì…ë ¥ ì™„ë£Œ í›„ ìƒì„¸ì£¼ì†Œ ì…ë ¥ë€ìœ¼ë¡œ ìŠ¤í¬ë¡¤
          setTimeout(()=>{
            el("addr2").focus();
            el("addr2").scrollIntoView({ behavior:"smooth", block:"center" });
          }, 200);
        } else {
          el("addrLayer").classList.remove("open");
          el("addr2").focus();
        }

        recalcShipping();
        validateStepButtons();
      };

      if(isMobile()){
        // ëª¨ë°”ì¼: íŒì—… ëª¨ë‹¬ ë°©ì‹
        openMobileAddrModal(onComplete);
      } else {
        // PC: ì¸ë¼ì¸ ì„ë² ë“œ ë°©ì‹
        const layer = el("addrLayer");
        layer.classList.add("open");
        new daum.Postcode({
          oncomplete: onComplete,
          onresize: (size)=>{ layer.style.height = Math.max(380, size.height) + "px"; },
          width: "100%",
          height: "100%"
        }).embed(layer);
      }
    }

    function openMobileAddrModal(onComplete){
      const backdrop = el("addrMobileBackdrop");
      const layer = el("addrMobileLayer");

      // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”
      layer.innerHTML = "";
      layer.classList.add("open");

      backdrop.classList.add("open");
      backdrop.setAttribute("aria-hidden","false");

      new daum.Postcode({
        oncomplete: onComplete,
        width: "100%",
        height: "100%"
      }).embed(layer);
    }

    function closeMobileAddrModal(){
      const backdrop = el("addrMobileBackdrop");
      const layer = el("addrMobileLayer");
      backdrop.classList.remove("open");
      backdrop.setAttribute("aria-hidden","true");
      layer.classList.remove("open");
      layer.innerHTML = "";
    }

    function buildPayload(){
      const items = [];
      for (const {product, qty} of state.cart.values()){
        items.push({
          id: product.id, category: product.category, name: product.name,
          unit_price: product.price, qty, line_total: product.price * qty
        });
      }
      const now = new Date();
      const orderId = `ORD-${now.getFullYear()}${String(now.getMonth()+1).padStart(2,"0")}${String(now.getDate()).padStart(2,"0")}-${now.getTime().toString().slice(-6)}`;
      return {
        order_id: orderId,
        created_at: now.toISOString(),
        orderer: {
          name: el("ordererName").value.trim(),
          emp_id: el("ordererEmpId").value.trim(),
          phone: el("ordererPhone").value.trim(),
          dept: el("ordererDept").value.trim()
        },
        recipient: {
          name: el("recvName").value.trim(),
          phone: el("recvPhone").value.trim(),
          address: { zip: el("zip").value.trim(), addr1: el("addr1").value.trim(), addr2: el("addr2").value.trim() }
        },
        shipping: { method: "íƒë°°ë°œì†¡", fee: state.shipFee, reason: state.shipFeeReason },
        note: el("note").value.trim(),
        items,
        items_total: calcItemsTotal(),
        grand_total: calcGrandTotal()
      };
    }

    function openSummary(){
      if (ORDER_CLOSED){ toast("í˜„ì¬ ì£¼ë¬¸ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤"); return; }
      if(state.cart.size === 0){ toast("ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤"); return; }
      if(!minOrderOk()){
        const remain = Math.max(0, MIN_ORDER_AMOUNT - calcItemsTotal());
        toast(`ìµœì†Œì£¼ë¬¸ê¸ˆì•¡ ${fmt(MIN_ORDER_AMOUNT)}ì› ( ${fmt(remain)}ì› ë” ë‹´ì•„ì£¼ì„¸ìš” )`);
        return;
      }

      const payload = buildPayload();
      const kv = el("summaryKV");
      kv.innerHTML = "";
      const rows = [
        ["ì£¼ë¬¸ë²ˆí˜¸", payload.order_id],
        ["ìš”ì²­ì¼ì‹œ", new Date(payload.created_at).toLocaleString("ko-KR")],
        ["ì£¼ë¬¸ì", `${payload.orderer.name} (${payload.orderer.dept})`],
        ["ì‚¬ë²ˆ", payload.orderer.emp_id || "-"],
        ["ì£¼ë¬¸ì ì—°ë½ì²˜", payload.orderer.phone || "-"],
        ["ìˆ˜ë ¹ì", payload.recipient.name],
        ["ìˆ˜ë ¹ì ì—°ë½ì²˜", payload.recipient.phone],
        ["ë°°ì†¡ì§€", `(${payload.recipient.address.zip}) ${payload.recipient.address.addr1} ${payload.recipient.address.addr2}`],
        ["ì¶œê³ /ë°°ì†¡ë¹„", `íƒë°°ë°œì†¡ / ${fmt(payload.shipping.fee)}ì› (${payload.shipping.reason})`],
        ["ë¹„ê³ ", payload.note || "-"],
      ];
      rows.forEach(([k,v])=>{
        const kEl = document.createElement("div"); kEl.style.color="var(--muted)"; kEl.textContent = k;
        const vEl = document.createElement("div"); vEl.style.fontWeight="900"; vEl.textContent = v;
        kv.appendChild(kEl); kv.appendChild(vEl);
      });

      const body = el("summaryItems");
      body.innerHTML = "";
      payload.items.forEach(it=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${it.category}</td><td>${it.name}</td>
          <td style="text-align:right;">${fmt(it.unit_price)}ì›</td>
          <td style="text-align:right;">${fmt(it.qty)}</td>
          <td style="text-align:right;">${fmt(it.line_total)}ì›</td>
        `;
        body.appendChild(tr);
      });

      el("summaryItemsTotal").textContent = `${fmt(payload.items_total)}ì›`;
      el("summaryShipFee").textContent = `${fmt(payload.shipping.fee)}ì›`;
      el("summaryGrandTotal").textContent = `${fmt(payload.grand_total)}ì›`;
      el("sendStatus").className = "status"; el("sendStatus").textContent = "ì „ì†¡ ëŒ€ê¸°";

      el("copyJsonBtn").onclick = async ()=>{
        try{ await navigator.clipboard.writeText(JSON.stringify(payload, null, 2)); toast("JSONì„ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤"); }
        catch{ toast("ë³µì‚¬ ì‹¤íŒ¨: ë¸Œë¼ìš°ì € ê¶Œí•œ í™•ì¸"); }
      };

      el("confirmSendBtn").disabled = false;
      el("confirmSendBtn").onclick = ()=>submit(payload);
      el("summaryBackdrop").classList.add("open");
      el("summaryBackdrop").setAttribute("aria-hidden","false");
    }

    function closeSummary(){
      el("summaryBackdrop").classList.remove("open");
      el("summaryBackdrop").setAttribute("aria-hidden","true");
    }

    async function submit(payload){
      if (ORDER_CLOSED){ toast("í˜„ì¬ ì£¼ë¬¸ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤"); return; }
      if(state.cart.size === 0){ toast("ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤"); return; }
      if(calcItemsTotal() < MIN_ORDER_AMOUNT){
        const remain = Math.max(0, MIN_ORDER_AMOUNT - calcItemsTotal());
        toast(`ìµœì†Œì£¼ë¬¸ê¸ˆì•¡ ë¯¸ë‹¬ (${fmt(remain)}ì› ë” ë‹´ì•„ì£¼ì„¸ìš”)`);
        return;
      }

      const st = el("sendStatus");
      const btn = el("confirmSendBtn");
      st.className="status"; st.textContent="ì „ì†¡ ì¤‘...";
      btn.disabled = true;

      try{
        const res = await fetch(WEB_APP_URL, {
          method:"POST",
          headers:{ "Content-Type":"text/plain;charset=utf-8" },
          body: JSON.stringify(payload)
        });
        const data = await res.json().catch(()=>({}));
        if(res.ok && data.ok){
          st.className="status ok"; st.textContent="ì œì¶œ ì™„ë£Œ";
          toast("ì œì¶œ ì™„ë£Œ");
          resetAfterSubmit();
        }else{
          st.className="status err"; st.textContent="ì œì¶œ ì‹¤íŒ¨";
          toast("ì œì¶œ ì‹¤íŒ¨");
          console.error("submit failed:", data);
          btn.disabled = false;
        }
      }catch(e){
        st.className="status err"; st.textContent="ì œì¶œ ì‹¤íŒ¨";
        toast("ë„¤íŠ¸ì›Œí¬/ê¶Œí•œ ë¬¸ì œ");
        console.error(e);
        btn.disabled = false;
      }
    }

    function resetAfterSubmit(){
      state.cart.clear();
      renderCartForStep4(); renderCartPreview();
      el("note").value = "";
      el("zip").value = ""; el("addr1").value = ""; el("addr2").value = "";
      state.shipFee = SHIPPING_BASE_FEE;
      state.shipFeeReason = "ê¸°ë³¸ ë¬´ë£Œë°°ì†¡";
      renderTotals(); validateStepButtons();
      closeSummary(); setStep(1);
    }

    /* ================================================================
       [ê°œì„  1] ê²Œì´íŠ¸ ëª¨ë‹¬: ë§ˆê° ì‹œ ì¦‰ì‹œ ì „ì²´ ì•ˆë‚´ + ì •ì±… ë¹„í™œì„±
       ================================================================ */
    function updateGateUI(){
      const status = el("gateStatus");
      const agree = el("agreeChk");
      const start = el("startBtn");

      if (ORDER_CLOSED){
        status.className = "status err";
        status.textContent = "ì£¼ë¬¸ ë§ˆê°";
        agree.disabled = true;
        agree.checked = false;
        start.disabled = true;
        return;
      }

      if(state.policyRead){
        status.className = "status ok";
        status.textContent = "ìŠ¤í¬ë¡¤ í™•ì¸ ì™„ë£Œ";
        agree.disabled = false;
      }else{
        status.className = "status err";
        status.textContent = "ìŠ¤í¬ë¡¤ í™•ì¸ í•„ìš”";
        agree.disabled = true;
        agree.checked = false;
      }

      start.disabled = !(state.policyRead && agree.checked);
    }

    function initGate(){
      const box = el("policyBox");
      const agree = el("agreeChk");

      state.policyRead = false;
      box.scrollTop = 0;
      agree.checked = false;

      if (ORDER_CLOSED){
        // [ê°œì„  1] ë§ˆê° ì•ˆë‚´ ë°°ë„ˆ í‘œì‹œ
        const banner = el("closedFullBanner");
        banner.style.display = "";
        el("closedFullMsg").textContent = ORDER_CLOSED_MSG;

        // [ê°œì„  1] ì •ì±… ì„¹ì…˜ ë¹„í™œì„±(íë¦¬ê²Œ)
        el("policySection").classList.add("policyDisabled");
      }

      updateGateUI();

      box.addEventListener("scroll", ()=>{
        if (ORDER_CLOSED) return;
        const nearBottom = (box.scrollTop + box.clientHeight) >= (box.scrollHeight - 6);
        if(nearBottom && !state.policyRead){
          state.policyRead = true;
          toast("ì•ˆë‚´ë¬¸ í™•ì¸ ì™„ë£Œ");
          updateGateUI();
        }
      });

      agree.addEventListener("change", ()=>{ updateGateUI(); });

      el("startBtn").onclick = ()=>{
        if (ORDER_CLOSED){ toast("í˜„ì¬ ì£¼ë¬¸ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤"); return; }
        if(!(state.policyRead && agree.checked)) return;
        el("gateBackdrop").classList.remove("open");
        el("gateBackdrop").setAttribute("aria-hidden","true");
        el("app").style.display = "";
        toast("ë™ì˜ í™•ì¸ ì™„ë£Œ");
      };
    }

    function openImagePreview(src, title, text){
      el("imgPreviewTarget").src = src;
      el("imgPreviewTitle").textContent = title;
      el("imgPreviewText").textContent = text || "";
      el("imgPreviewText").style.display = (text && text.trim()) ? "" : "none";
      el("imgPreview").classList.add("open");
    }
    function closeImagePreview(){ el("imgPreview").classList.remove("open"); }

    function init(){
      el("maxQtyText").textContent = String(MAX_QTY_PER_ITEM);

      initGate();

      el("toStep2").onclick = ()=>setStep(2);
      el("toStep3").onclick = ()=>setStep(3);
      el("toStep4").onclick = ()=>setStep(4);
      el("backTo1").onclick = ()=>setStep(1);
      el("backTo2").onclick = ()=>setStep(2);
      el("backTo3").onclick = ()=>setStep(3);

      el("clearCartBtn").onclick = clearCart;

      [
        "ordererName","ordererEmpId","ordererPhone","ordererDept",
        "recvName","recvPhone","zip","addr1","addr2","note"
      ].forEach(id=>{
        el(id).addEventListener("input", ()=>{
          if (el("sameAsOrdererChk").checked && (id==="ordererName" || id==="ordererPhone")){
            el("recvName").value = el("ordererName").value.trim();
            el("recvPhone").value = el("ordererPhone").value.trim();
          }
          if(id==="zip") recalcShipping();
          validateStepButtons();
        });
      });

      el("addrSearchBtn").onclick = openAddressSearchEmbed;

      // [ê°œì„  3] ëª¨ë°”ì¼ ì£¼ì†Œ ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
      el("addrMobileCloseBtn").onclick = closeMobileAddrModal;

      el("submitBtn").onclick = openSummary;
      el("closeSummaryBtn").onclick = closeSummary;
      el("summaryBackdrop").addEventListener("click", e=>{
        if(e.target===el("summaryBackdrop")) closeSummary();
      });

      renderTabs();
      renderProducts();
      renderCartForStep4();
      renderCartPreview();
      renderTotals();
      validateStepButtons();

      ["ordererPhone", "recvPhone"].forEach((id) => {
        el(id).addEventListener("input", (e) => {
          const digits = e.target.value.replace(/\D/g, "").slice(0, 11);
          if (digits.length <= 3) e.target.value = digits;
          else if (digits.length <= 7) e.target.value = digits.replace(/(\d{3})(\d+)/, "$1-$2");
          else e.target.value = digits.replace(/(\d{3})(\d{4})(\d+)/, "$1-$2-$3");
        });
      });

      el("sameAsOrdererChk").addEventListener("change", (e) => {
        const on = e.target.checked;
        if (on) {
          el("recvName").value = el("ordererName").value.trim();
          el("recvPhone").value = el("ordererPhone").value.trim();
          toast("ìˆ˜ë ¹ì ì •ë³´ì— ì£¼ë¬¸ì ì •ë³´ë¥¼ ì…ë ¥í–ˆìŠµë‹ˆë‹¤");
        } else {
          el("recvName").value = "";
          el("recvPhone").value = "";
        }
        validateStepButtons();
      });
    }

    init();
  </script>
</body>
</html>
